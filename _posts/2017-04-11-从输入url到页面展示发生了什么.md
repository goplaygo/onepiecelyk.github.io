---
layout: post
title: 从输入url到页面展示发生了什么
date: 2017-04-11 
tags: 博客   
---

### 前言
之前面试总会被问到当我们输入url时经过了什么步骤，最近在看http协议相关的文章。看到一篇文章讲解的较为详细，就想着记录下来。

链接：[咸鱼老弟-博客园](www.cnblogs.com/xianyulaodi/p/6547807.html);


当我们输入url时一共经过了9步，然后会展示给我们页面上的内容
 - 1、输入地址
 - 2、浏览器查找域名的ip地址
 - 3、浏览器向web服务器发送一个HTTP请求
 - 4、服务器的永久重定向响应
 - 5、浏览器跟踪重定向地址
 - 6、服务器处理请求
 - 7、服务器返回一个HTTP响应
 - 8、浏览器显示html
 - 9、浏览器发送请求获取嵌入在html中的资源（图片、音频、视频、CSS、JS等）
 
总体过程如下：

#### 1、输入地址

<hr>

当我们开始在浏览器中输入网址时，浏览器已经开始智能匹配可得的url了，它会从历史记录，书签等地方，找到已经输入的字符串可能对应的url，然后智能提示，让你可以补全url地址。对于Google Chrome，它甚至可以从缓存中把网页展示出来。

#### 2、浏览器查找域名的IP地址

<hr>

1、请求一旦发起，浏览器首先要做的是解析域名，一般来说，浏览器会首先查看本地硬盘的hosts文件，查看其中有没有与这个域名对应的规则，如果有则直接使用hosts里的ip地址

2、如果在本地hosts文件里的未找到对应的ip地址，浏览器会发出一个DNS请求到本地的DNS服务器。本地DNS服务器一般都是你的网络接入服务器商提供，如中国电信，中国联通。

3、查询你输入的DNS请求到达本地DNS服务器之后，本地DNS服务器会先查询它的缓存记录，如果缓存中包含此记录，则直接返回结果，在此过程中是递归的方式进行查询。若本地没有记录，则本地DNS服务器还要向DNS根服务器进行查询。

4、根DNS服务器没有记录的域名和IP地址的对应关系，而是告诉本地DNS服务器，你可以到域服务器上继续查询，并给出域服务器的地址。这种过称是迭代的过程。

5、本地DNS服务器继续向域服务器发出请求，而例如像.com域服务器，.com于服务器收到请求后，也不会直接返回和IP地址的对应关系，而是告诉本地DNS服务器，你的域名的解析服务器的地址。

6、最后，本地DNS服务器向域名的解析服务器发出请求，这时就能收到一个域名和IP地址对应关系，本地DNS服务器不仅要把IP地址返回给用户电脑，还要把这个对应关系保存到缓存中，以备下次使用，加快网络访问。

下面图片可以完美解释此过程：

![](/images/posts/170411/dns解析过程.png)

##### 知识扩展

1）什么是DNS？

DNS（Domain Name System，域名系统），因特网上作为域名和IP地址互相映射的一个分布式数据库，能够使用户更方便的访问互联网，而不用去记住被机器直接读取的IP数串。通过主机名，最终得到改主机名对应的IP地址的过程叫做域名解析（或主机名解析）。

用更通俗的话来讲，我们通常习惯记住一个网站的名字，而不是它的ip地址，比如www.baidu.com,ip地址为167.23.10.2。而计算机更擅长记住网站的ip地址，而不像www.baidu.com等连接。因为，DNS就相当于一个电话本，比如你要找www.baidu.com这个域名，那我翻一翻我的电话本，就会知道它的电话（ip）是167.23.10.2。

2）DNS查询的两种方式：递归查询和迭代查询

1、递归查询

当局部DNS服务器自己不能回答客户机的DNS查询时，它就需要向其他DNS服务器进行查询。此时有两种方式，如图所示的是递归方式。局部DNS服务器自己负责向其他DNS服务器进行查询，一般是先向该域名的根域服务器查询，再由根域名服务器一级级像下查询。最后得到查询结果返回给局部DNS服务器，再由局部DNS服务器返回给客户端。

![](/images/posts/170411/递归解析.png)

2、迭代解析

当局部DNS服务器自己不能回答客户机的DNS查询时，也可以通过迭代查询的方式进行解析，如图所示，局部DNS服务器不是自己向其他DNS服务器查询，而是把能解析改域名的其他DNS服务器的ip地址返回给客户端DNS程序，
客户端DNS程序再继续向这些DNS服务器进行查询。直到查询到结果为止。也就是说，迭代解析只是帮你找到相关的服务器而已，而不会帮你去查。比如说：baidu.com的服务器ip地址为192.168.4.5这里，你自己去查询吧，本服务器比较忙，只能帮你到这了。

![](/images/posts/170411/迭代解析.png)

3）DNS域名名称空间的组织方式

我们在前面说的根DNS服务器，域DNS服务器，这些都是DNS域名称空间的组织方式。按照功能命名空间中用来描述DNS域民称的五个类别的介绍如下图所示：

![](/images/posts/170411/域名讲解.png)

4）DNS负载均衡

当一个网站有足够多的用户时，如果每次请求的资源都位于同一台机器上面，那么这台机器随时都会崩掉。我们的解决办法就是使用DNS负载均衡技术，它的原理是在DNS服务器中为同一个主机名配置多个IP地址，在应答DNS查询时，DNS服务器对每个查询将以DNS文件中主机记录的IP地址按顺序返回不同的解析结果，将客户端的访问引导到不同的机器上去，使得不同的客户端访问不同的服务器，从而达到负载均衡的目的。例如可以根据每台机器的负载量，该机器离用户地理位置的距离等。

#### 3、浏览器向web服务器发送一个HTTP请求

<hr>








